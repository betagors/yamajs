# Example YAMA configuration showcasing the new clean syntax
# This demonstrates the improved entity and relation syntax inspired by modern frameworks

project:
  name: blog-api
  version: 1.0.0

# Entities with new clean syntax
entities:
  User:
    table: users
    fields:
      id: uuid!                      # ! = required
      email: string!                  # Required string
      name: string!
      avatarUrl: string?              # ? = nullable
      role: enum[user, admin]         # Enum shorthand
      createdAt: timestamp            # Auto-populated
    
    # Relationships (dedicated section)
    relations:
      posts: hasMany(Post)
      profile: hasOne(Profile)
      comments: hasMany(Comment)
    
    # Validations (declarative)
    validations:
      email: [email, unique]
      name: [minLength(2), maxLength(100)]
    
    # Computed fields
    computed:
      fullName: "{firstName} {lastName}"
      postCount: "count(posts)"
    
    # Hooks (optional, for complex logic)
    hooks:
      beforeCreate: ./hooks/user.beforeCreate.ts
      afterCreate: ./hooks/user.afterCreate.ts
    
    # CRUD configuration
    crud:
      enabled: true

  Post:
    table: posts
    fields:
      id: uuid!
      title: string!
      content: text!
      published: boolean = false      # Default value
      publishedAt: timestamp?
      authorId: uuid!
    
    relations:
      author: belongsTo(User)
      comments: hasMany(Comment)
      tags: manyToMany(Tag)
    
    validations:
      title: [minLength(5), maxLength(200)]
      content: [minLength(10)]
    
    # Indexes (auto-generated, but customizable)
    indexes:
      - [authorId, publishedAt]      # Composite index
      - published                    # Single field index
    
    # Soft deletes
    softDelete: true
    
    crud:
      enabled: true

  Comment:
    table: comments
    fields:
      id: uuid!
      content: text!
      postId: uuid!
      userId: uuid!
    
    relations:
      post: belongsTo(Post)
      user: belongsTo(User)
    
    crud:
      enabled: true

  Tag:
    table: tags
    fields:
      id: uuid!
      name: string!
      slug: string!
    
    validations:
      name: [unique]
      slug: [unique, slug]
    
    relations:
      posts: manyToMany(Post)
    
    crud:
      enabled: true

  Profile:
    table: profiles
    fields:
      id: uuid!
      userId: uuid!
      bio: text?
      website: string?
    
    relations:
      user: belongsTo(User)

# Endpoints (custom API routes)
endpoints:
  - path: /users/me
    method: GET
    handler: getCurrentUser
    auth:
      required: true
    response:
      type: User

# Monitoring configuration
monitoring:
  level: info
  sampling:
    rate: 0.1  # Sample 10% of requests
    errors: 1.0  # Always track errors
  custom:
    - name: user_signups
      type: counter
      description: "Number of user signups"
    - name: post_publish_duration
      type: histogram
      description: "Time to publish a post"

# Plugins
plugins:
  "@betagors/yama-pglite":

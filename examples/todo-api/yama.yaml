# Example YAMA configuration showcasing the new clean syntax
# This demonstrates the improved entity and relation syntax inspired by modern frameworks

project:
  name: blog-api
  version: 1.0.0

# Entities with optimized inline syntax
entities:
  User:
    table: users
    fields:
      id: uuid!
      email: string! unique          # Inline constraint: unique
      name: string! indexed          # Inline constraint: indexed
      avatarUrl: string?             # ? = nullable
      role: enum[user, admin]
      createdAt: timestamp
      # Inline relations - auto-generates foreign keys
      posts: Post[]                  # hasMany - auto-generates nothing
      profile: Profile?              # hasOne - nullable
      comments: Comment[]            # hasMany
    
    # Validations (declarative)
    validation:
      emailFormat:
        field: email
        rule: email
      nameMinLength:
        field: name
        rule: minLength
        params: [2]
      nameMaxLength:
        field: name
        rule: maxLength
        params: [100]
    
    # Computed fields
    computed:
      fullName: "{firstName} {lastName}"
      postCount: "count(posts)"
    
    # Hooks (optional, for complex logic)
    hooks:
      beforeCreate: ./hooks/user.beforeCreate.ts
      afterCreate: ./hooks/user.afterCreate.ts
    
    # CRUD configuration
    crud:
      enabled: true

  Post:
    table: posts
    fields:
      id: uuid!
      title: string! indexed         # Inline constraint: indexed
      content: text!
      published: boolean = false
      publishedAt: timestamp?
      # Inline relation - auto-generates authorId: uuid!
      author: User! cascade         # belongsTo with cascade delete
      comments: Comment[]           # hasMany
      tags: Tag[] through:post_tags # manyToMany with junction table
    
    validation:
      titleMinLength:
        field: title
        rule: minLength
        params: [5]
      titleMaxLength:
        field: title
        rule: maxLength
        params: [200]
      contentMinLength:
        field: content
        rule: minLength
        params: [10]
    
    # Indexes (auto-generated, but customizable)
    indexes:
      - [authorId, publishedAt]      # Composite index (authorId auto-generated)
      - published                    # Single field index
    
    # Soft deletes
    softDelete: true
    
    crud:
      enabled: true

  Comment:
    table: comments
    fields:
      id: uuid!
      content: text!
      # Inline relations - auto-generate foreign keys
      post: Post! cascade            # belongsTo - auto-generates postId
      user: User!                    # belongsTo - auto-generates userId
    
    crud:
      enabled: true

  Tag:
    table: tags
    fields:
      id: uuid!
      name: string! unique          # Inline constraint: unique
      slug: string! unique indexed   # Multiple inline constraints
      posts: Post[]                  # manyToMany (no through specified = hasMany relation)
    
    crud:
      enabled: true

  Profile:
    table: profiles
    fields:
      id: uuid!
      # Inline relation - auto-generates userId
      user: User!                    # belongsTo - auto-generates userId
      bio: text?
      website: string?

# Endpoints (custom API routes)
endpoints:
  - path: /users/me
    method: GET
    handler: src/handlers/getCurrentUser.ts
    auth:
      required: true
    response:
      type: User

# Monitoring configuration
monitoring:
  level: info
  sampling:
    rate: 0.1  # Sample 10% of requests
    errors: 1.0  # Always track errors
  custom:
    - name: user_signups
      type: counter
      description: "Number of user signups"
    - name: post_publish_duration
      type: histogram
      description: "Time to publish a post"

# Plugins
plugins:
  "@betagors/yama-pglite":

# yaml-language-server: $schema=../../packages/cli/src/yama.schema.json
name: todo-api
version: 1.0.0

plugins:
  "@betagors/yama-pglite":

entities:
  Todo:
    table: todos
    # Example: Using CRUD with custom input and response types
    # crud:
    #   enabled: true
    #   inputTypes:
    #     PATCH: UpdateStatusInput
    #   responseTypes:
    #     GET_LIST: TodoSummary
    #     GET_ONE: TodoDetail
    #     POST: Todo
    fields:
      id:
        type: uuid
        primary: true
        generated: true
      title:
        type: string
        required: true
        maxLength: 500
      completed:
        type: boolean
        default: false

schemas:
  CreateTodoInput:
    fields:
      title:
        type: string
        required: true
      completed:
        type: boolean
        default: false

  UpdateTodoInput:
    fields:
      title:
        type: string
        required: false
      completed:
        type: boolean
        required: false

  TodoList:
    fields:
      todos:
        type: list
        items:
          $ref: Todo

  # Example custom schemas for CRUD operations
  # UpdateStatusInput:
  #   fields:
  #     completed:
  #       type: boolean
  #       required: true
  #
  # TodoSummary:
  #   fields:
  #     id:
  #       type: string
  #     title:
  #       type: string
  #     completed:
  #       type: boolean
  #
  # TodoDetail:
  #   fields:
  #     id:
  #       type: string
  #     title:
  #       type: string
  #     description:
  #       type: string
  #     completed:
  #       type: boolean
  #     createdAt:
  #       type: string
  #       format: date-time
  #     updatedAt:
  #       type: string
  #       format: date-time

endpoints:
  - path: /todos
    method: GET
    handler: getTodos
    description: Get all todos
    auth:
      required: true
      roles: [user, admin]
    query:
      completed:
        type: boolean
        required: false
      limit:
        type: integer
        required: false
        min: 1
        max: 100
      offset:
        type: integer
        required: false
        min: 0
    response:
      type: TodoList
  
  - path: /todos
    method: POST
    handler: createTodo
    description: Create a new todo
    body:
      type: CreateTodoInput
    response:
      type: Todo
  
  - path: /todos/:id
    method: GET
    handler: getTodoById
    description: Get a single todo by ID
    params:
      id:
        type: string
        required: true
    response:
      type: Todo
  
  - path: /todos/:id
    method: PUT
    handler: updateTodo
    description: Update a todo
    params:
      id:
        type: string
        required: true
    body:
      type: UpdateTodoInput
    response:
      type: Todo
  
  - path: /todos/:id
    method: DELETE
    handler: deleteTodo
    description: Delete a todo
    params:
      id:
        type: string
        required: true
